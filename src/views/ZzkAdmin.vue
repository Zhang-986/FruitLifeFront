<template>
    <div class="admin-panel">
        <!-- ‰ΩøÁî®Áªü‰∏ÄÂØºËà™ -->
        <AppNavigation />

        <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
        <div class="admin-content">
            <v-container fluid class="pa-6">




                <!-- ÁÆ°ÁêÜÊ®°ÂùóÂÖ•Âè£ -->
                <div class="management-modules">
                    <h2 class="section-title mb-6">
                        <v-icon color="deep-purple" class="mr-3">mdi-view-dashboard</v-icon>
                        ÁÆ°ÁêÜÊ®°Âùó
                    </h2>

                    <v-row>
                        <!-- Ê∞¥ÊûúÁÆ°ÁêÜÊ®°Âùó -->
                        <v-col cols="12" md="6">
                            <v-card class="module-card fruit-module" elevation="6" rounded="xl"
                                @click="goToFruitManagement" hover>
                                <div class="module-header fruit-gradient">
                                    <v-card-title class="text-white d-flex align-center pa-6">
                                        <div class="module-icon mr-4">üçé</div>
                                        <div>
                                            <h3 class="text-h5 font-weight-bold">Ê∞¥ÊûúÁÆ°ÁêÜÁ≥ªÁªü</h3>
                                            <p class="text-subtitle-1 opacity-90 mb-0">ÁÆ°ÁêÜÊ∞¥Êûú‰ø°ÊÅØ„ÄÅÂàÜÁ±ªÂíåÂ∫ìÂ≠ò</p>
                                        </div>
                                    </v-card-title>
                                </div>

                                <v-card-text class="pa-6">
                                    <div class="module-stats mb-4">
                                        <v-row>
                                            <v-col cols="6">
                                                <div class="text-center">
                                                    <div class="text-h6 font-weight-bold text-primary">{{
                                                        adminStats.fruitCount }}</div>
                                                    <div class="text-caption">Ê∞¥ÊûúÁßçÁ±ª</div>
                                                </div>
                                            </v-col>
                                            <v-col cols="6">
                                                <div class="text-center">
                                                    <div class="text-h6 font-weight-bold text-success">23</div>
                                                    <div class="text-caption">ÂàÜÁ±ªÊï∞Èáè</div>
                                                </div>
                                            </v-col>
                                        </v-row>
                                    </div>

                                    <v-list density="compact">
                                        <v-list-item>
                                            <template v-slot:prepend>
                                                <v-icon color="primary" size="small">mdi-plus</v-icon>
                                            </template>
                                            <v-list-item-title class="text-body-2">Ê∑ªÂä†ÂíåÁºñËæëÊ∞¥Êûú‰ø°ÊÅØ</v-list-item-title>
                                        </v-list-item>
                                        <v-list-item>
                                            <template v-slot:prepend>
                                                <v-icon color="primary" size="small">mdi-view-list</v-icon>
                                            </template>
                                            <v-list-item-title class="text-body-2">Êü•ÁúãÂíåÁÆ°ÁêÜÊ∞¥ÊûúÂàóË°®</v-list-item-title>
                                        </v-list-item>
                                        <v-list-item>
                                            <template v-slot:prepend>
                                                <v-icon color="primary" size="small">mdi-image-multiple</v-icon>
                                            </template>
                                            <v-list-item-title class="text-body-2">ÊâπÈáèÂõæÁâáÁÆ°ÁêÜ</v-list-item-title>
                                        </v-list-item>
                                    </v-list>
                                </v-card-text>

                                <v-card-actions class="pa-6 pt-0">
                                    <v-btn color="primary" variant="elevated" block size="large"
                                        class="font-weight-bold" @click="goToFruitManagement">
                                        <v-icon start>mdi-fruit-cherries</v-icon>
                                        ËøõÂÖ•Ê∞¥ÊûúÁÆ°ÁêÜ
                                        <v-icon end>mdi-arrow-right</v-icon>
                                    </v-btn>
                                </v-card-actions>
                            </v-card>
                        </v-col>

                        <!-- ‰ªªÂä°ÁÆ°ÁêÜÊ®°Âùó -->
                        <v-col cols="12" md="6">
                            <v-card class="module-card task-module" elevation="6" rounded="xl"
                                @click="goToTaskManagement" hover>
                                <div class="module-header task-gradient">
                                    <v-card-title class="text-white d-flex align-center pa-6">
                                        <div class="module-icon mr-4">üìã</div>
                                        <div>
                                            <h3 class="text-h5 font-weight-bold">‰ªªÂä°ÁÆ°ÁêÜÁ≥ªÁªü</h3>
                                            <p class="text-subtitle-1 opacity-90 mb-0">ÁÆ°ÁêÜÁ≥ªÁªü‰ªªÂä°ÂíåÁî®Êà∑Ê¥ªÂä®</p>
                                        </div>
                                    </v-card-title>
                                </div>

                                <v-card-text class="pa-6">
                                    <div class="module-stats mb-4">
                                        <v-row>
                                            <v-col cols="6">
                                                <div class="text-center">
                                                    <div class="text-h6 font-weight-bold text-orange">{{
                                                        taskStats.totalTasks }}</div>
                                                    <div class="text-caption">ÊÄª‰ªªÂä°</div>
                                                </div>
                                            </v-col>
                                            <v-col cols="6">
                                                <div class="text-center">
                                                    <div class="text-h6 font-weight-bold text-success">{{
                                                        taskStats.activeTasks }}</div>
                                                    <div class="text-caption">Ê¥ªË∑É‰ªªÂä°</div>
                                                </div>
                                            </v-col>
                                        </v-row>
                                    </div>

                                    <v-list density="compact">
                                        <v-list-item>
                                            <template v-slot:prepend>
                                                <v-icon color="orange" size="small">mdi-plus</v-icon>
                                            </template>
                                            <v-list-item-title class="text-body-2">ÂàõÂª∫ÂíåÂàÜÈÖç‰ªªÂä°</v-list-item-title>
                                        </v-list-item>
                                        <v-list-item>
                                            <template v-slot:prepend>
                                                <v-icon color="orange" size="small">mdi-chart-timeline</v-icon>
                                            </template>
                                            <v-list-item-title class="text-body-2">‰ªªÂä°ËøõÂ∫¶Ë∑üË∏™</v-list-item-title>
                                        </v-list-item>
                                        <v-list-item>
                                            <template v-slot:prepend>
                                                <v-icon color="orange" size="small">mdi-account-check</v-icon>
                                            </template>
                                            <v-list-item-title class="text-body-2">Áî®Êà∑Ê¥ªÂä®ÁõëÊéß</v-list-item-title>
                                        </v-list-item>
                                    </v-list>
                                </v-card-text>

                                <v-card-actions class="pa-6 pt-0">
                                    <v-btn color="orange" variant="elevated" block size="large" class="font-weight-bold"
                                        @click="goToTaskManagement">
                                        <v-icon start>mdi-clipboard-list</v-icon>
                                        ËøõÂÖ•‰ªªÂä°ÁÆ°ÁêÜ
                                        <v-icon end>mdi-arrow-right</v-icon>
                                    </v-btn>
                                </v-card-actions>
                            </v-card>
                        </v-col>
                    </v-row>
                </div>
            </v-container>

        </div>
        <!-- ÁªüËÆ°Ê¶ÇËßà -->
        <div class="stats-overview mb-8">
            <v-row>
                <v-col cols="12" sm="6" md="3">
                    <v-card class="stat-card" elevation="4" rounded="xl" color="primary">
                        <v-card-text class="pa-6 text-center text-white">
                            <v-icon size="48" class="mb-3">mdi-fruit-cherries</v-icon>
                            <div class="text-h4 font-weight-bold">{{ adminStats.fruitCount }}</div>
                            <div class="text-subtitle-1">Ê∞¥ÊûúÁßçÁ±ª</div>
                        </v-card-text>
                    </v-card>
                </v-col>
                <v-col cols="12" sm="6" md="3">
                    <v-card class="stat-card" elevation="4" rounded="xl" color="success">
                        <v-card-text class="pa-6 text-center text-white">
                            <v-icon size="48" class="mb-3">mdi-account-group</v-icon>
                            <div class="text-h4 font-weight-bold">{{ adminStats.userCount }}</div>
                            <div class="text-subtitle-1">Ê≥®ÂÜåÁî®Êà∑</div>
                        </v-card-text>
                    </v-card>
                </v-col>
                <v-col cols="12" sm="6" md="3">
                    <v-card class="stat-card" elevation="4" rounded="xl" color="warning">
                        <v-card-text class="pa-6 text-center text-white">
                            <v-icon size="48" class="mb-3">mdi-clipboard-list</v-icon>
                            <div class="text-h4 font-weight-bold">{{ taskStats.totalTasks }}</div>
                            <div class="text-subtitle-1">‰ªªÂä°ÊÄªÊï∞</div>
                        </v-card-text>
                    </v-card>
                </v-col>
                <v-col cols="12" sm="6" md="3">
                    <v-card class="stat-card" elevation="4" rounded="xl" color="info">
                        <v-card-text class="pa-6 text-center text-white">
                            <v-icon size="48" class="mb-3">mdi-chart-line</v-icon>
                            <div class="text-h4 font-weight-bold">{{ formatSales }}</div>
                            <div class="text-subtitle-1">‰ªäÊó•ÈîÄÂîÆÈ¢ù</div>
                        </v-card-text>
                    </v-card>
                </v-col>
            </v-row>
        </div>
    </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { useAuthStore } from '@/stores/auth'
import { getAdminStats, type AdminStats } from '@/utils/admin-api'
import AppNavigation from '@/components/AppNavigation.vue'

const router = useRouter()
const authStore = useAuthStore()

// ÂìçÂ∫îÂºèÊï∞ÊçÆ
const loading = ref(false)
const adminStats = ref<AdminStats>({
    fruitCount: 0,
    userCount: 0,
    pendingOrders: 0,
    todaySales: 0
})

// ‰ªªÂä°ÁªüËÆ°Êï∞ÊçÆÔºàÊ®°ÊãüÔºâ
const taskStats = ref({
    totalTasks: 45,
    activeTasks: 23,
    completedTasks: 22
})

// Âø´ÈÄüÊìç‰ΩúÂàóË°®
const quickActions = ref([
    { title: 'Ê∑ªÂä†Ê∞¥Êûú', icon: 'mdi-plus', color: 'primary', action: 'add-fruit' },
    { title: 'Áî®Êà∑ÁÆ°ÁêÜ', icon: 'mdi-account-group', color: 'success', action: 'user-management' },
    { title: 'Á≥ªÁªüËÆæÁΩÆ', icon: 'mdi-cog', color: 'info', action: 'system-settings' },
    { title: 'Êï∞ÊçÆÊä•Ë°®', icon: 'mdi-chart-bar', color: 'purple', action: 'reports' },
    { title: 'Â§á‰ªΩÊï∞ÊçÆ', icon: 'mdi-database-export', color: 'orange', action: 'backup' },
    { title: 'Á≥ªÁªüÊó•Âøó', icon: 'mdi-text-box-search', color: 'grey', action: 'logs' }
])

// ËÆ°ÁÆóÂ±ûÊÄß
const formatSales = computed(() => {
    const sales = adminStats.value.todaySales
    if (sales >= 10000) {
        return `¬•${(sales / 1000).toFixed(1)}k`
    }
    return `¬•${sales}`
})

// ÊñπÊ≥ï
const goToFruitManagement = () => {
    console.log('Navigating to Fruit Management page')
    // Á°Æ‰øùËøôÈáå‰ΩøÁî®ÁöÑÊòØÂú® router/index.ts ‰∏≠ÂÆö‰πâÁöÑ name Êàñ path
    router.push({ name: 'FruitManagement' })
    // ÊàñËÄÖ‰ΩøÁî®Ë∑ØÂæÑ: router.push('/fruit-management')
}

const goToTaskManagement = () => {
    router.push('/task-management')
}

const goToUserManagement = () => {
    console.log('üöÄ Ë∑≥ËΩ¨Âà∞Áî®Êà∑ÁÆ°ÁêÜ')
    // router.push('/user-management') // Á≠âÁî®Êà∑ÁÆ°ÁêÜÈ°µÈù¢ÂÆåÊàêÂêéÂêØÁî®
}

// Âä†ËΩΩÁÆ°ÁêÜÂëòÁªüËÆ°Êï∞ÊçÆ
const loadAdminStats = async () => {
    try {
        const response = await getAdminStats()
        if (response.code === 200) {
            adminStats.value = response.data
        }
    } catch (error) {
        console.error('Âä†ËΩΩÁÆ°ÁêÜÂëòÁªüËÆ°Êï∞ÊçÆÂ§±Ë¥•:', error)
        // ‰ΩøÁî®ÈªòËÆ§Êï∞ÊçÆ
        adminStats.value = {
            fruitCount: 23,
            userCount: 156,
            pendingOrders: 89,
            todaySales: 12500
        }
    }
}

onMounted(async () => {
    // Ê£ÄÊü•ÁÆ°ÁêÜÂëòÊùÉÈôê
    if (!authStore.isAdmin) {
        router.replace('/user')
        return
    }

    await loadAdminStats()
})
</script>

<style scoped>
.admin-panel {
    min-height: 100vh;
    background: #f5f5f5;
}

.admin-content {
    margin-top: 64px;
}

.admin-icon {
    font-size: 4rem;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
}

.stat-card {
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
}

.module-card {
    transition: all 0.3s ease;
    cursor: pointer;
    border: 2px solid transparent;
}

.module-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15) !important;
    border-color: rgba(76, 175, 80, 0.3);
}

.module-icon {
    font-size: 3rem;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

.fruit-gradient {
    background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
}

.task-gradient {
    background: linear-gradient(135deg, #FF9800 0%, #FFB74D 100%);
}

.quick-action-card {
    transition: all 0.3s ease;
    cursor: pointer;
}

.quick-action-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
}

.section-title {
    font-size: 1.5rem;
    font-weight: 700;
    display: flex;
    align-items: center;
}

/* ÁßªÂä®Á´ØÈÄÇÈÖç */
@media (max-width: 600px) {
    .admin-content {
        margin-top: 56px;
    }

    .module-card .module-icon {
        font-size: 2.5rem;
    }
}
</style>
