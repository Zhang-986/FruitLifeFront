<template>
    <div class="admin-panel">
        <!-- ä½¿ç”¨ç»Ÿä¸€å¯¼èˆª -->
        <AppNavigation />

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="admin-content">
            <v-container fluid class="pa-6">




                <!-- ç®¡ç†æ¨¡å—å…¥å£ -->
                <div class="management-modules">
                    <h2 class="section-title mb-6">
                        <v-icon color="deep-purple" class="mr-3">mdi-view-dashboard</v-icon>
                        ç®¡ç†æ¨¡å—
                    </h2>

                    <v-row>
                        <!-- æ°´æœç®¡ç†æ¨¡å— -->
                        <v-col cols="12" md="6">
                            <v-card class="module-card fruit-module" elevation="6" rounded="xl"
                                @click="goToFruitManagement" hover>
                                <div class="module-header fruit-gradient">
                                    <v-card-title class="text-white d-flex align-center pa-6">
                                        <div class="module-icon mr-4">ğŸ</div>
                                        <div>
                                            <h3 class="text-h5 font-weight-bold">æ°´æœç®¡ç†ç³»ç»Ÿ</h3>
                                            <p class="text-subtitle-1 opacity-90 mb-0">ç®¡ç†æ°´æœä¿¡æ¯ã€åˆ†ç±»å’Œåº“å­˜</p>
                                        </div>
                                    </v-card-title>
                                </div>

                                <v-card-text class="pa-6">
                                    <div class="module-stats mb-4">
                                        <v-row>
                                            <v-col cols="6">
                                                <div class="text-center">
                                                    <div class="text-h6 font-weight-bold text-primary">{{
                                                        adminStats.fruitCount }}</div>
                                                    <div class="text-caption">æ°´æœç§ç±»</div>
                                                </div>
                                            </v-col>
                                            <v-col cols="6">
                                                <div class="text-center">
                                                    <div class="text-h6 font-weight-bold text-success">23</div>
                                                    <div class="text-caption">åˆ†ç±»æ•°é‡</div>
                                                </div>
                                            </v-col>
                                        </v-row>
                                    </div>

                                    <v-list density="compact">
                                        <v-list-item>
                                            <template v-slot:prepend>
                                                <v-icon color="primary" size="small">mdi-plus</v-icon>
                                            </template>
                                            <v-list-item-title class="text-body-2">æ·»åŠ å’Œç¼–è¾‘æ°´æœä¿¡æ¯</v-list-item-title>
                                        </v-list-item>
                                        <v-list-item>
                                            <template v-slot:prepend>
                                                <v-icon color="primary" size="small">mdi-view-list</v-icon>
                                            </template>
                                            <v-list-item-title class="text-body-2">æŸ¥çœ‹å’Œç®¡ç†æ°´æœåˆ—è¡¨</v-list-item-title>
                                        </v-list-item>
                                        <v-list-item>
                                            <template v-slot:prepend>
                                                <v-icon color="primary" size="small">mdi-image-multiple</v-icon>
                                            </template>
                                            <v-list-item-title class="text-body-2">æ‰¹é‡å›¾ç‰‡ç®¡ç†</v-list-item-title>
                                        </v-list-item>
                                    </v-list>
                                </v-card-text>

                                <v-card-actions class="pa-6 pt-0">
                                    <v-btn color="primary" variant="elevated" block size="large"
                                        class="font-weight-bold" @click="goToFruitManagement">
                                        <v-icon start>mdi-fruit-cherries</v-icon>
                                        è¿›å…¥æ°´æœç®¡ç†
                                        <v-icon end>mdi-arrow-right</v-icon>
                                    </v-btn>
                                </v-card-actions>
                            </v-card>
                        </v-col>

                        <!-- ä»»åŠ¡ç®¡ç†æ¨¡å— -->
                        <v-col cols="12" md="6">
                            <v-card class="module-card task-module" elevation="6" rounded="xl"
                                @click="goToTaskManagement" hover>
                                <div class="module-header task-gradient">
                                    <v-card-title class="text-white d-flex align-center pa-6">
                                        <div class="module-icon mr-4">ğŸ“‹</div>
                                        <div>
                                            <h3 class="text-h5 font-weight-bold">ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ</h3>
                                            <p class="text-subtitle-1 opacity-90 mb-0">ç®¡ç†ç³»ç»Ÿä»»åŠ¡å’Œç”¨æˆ·æ´»åŠ¨</p>
                                        </div>
                                    </v-card-title>
                                </div>

                                <v-card-text class="pa-6">
                                    <div class="module-stats mb-4">
                                        <v-row>
                                            <v-col cols="6">
                                                <div class="text-center">
                                                    <div class="text-h6 font-weight-bold text-orange">{{
                                                        taskStats.totalTasks }}</div>
                                                    <div class="text-caption">æ€»ä»»åŠ¡</div>
                                                </div>
                                            </v-col>
                                            <v-col cols="6">
                                                <div class="text-center">
                                                    <div class="text-h6 font-weight-bold text-success">{{
                                                        taskStats.activeTasks }}</div>
                                                    <div class="text-caption">æ´»è·ƒä»»åŠ¡</div>
                                                </div>
                                            </v-col>
                                        </v-row>
                                    </div>

                                    <v-list density="compact">
                                        <v-list-item>
                                            <template v-slot:prepend>
                                                <v-icon color="orange" size="small">mdi-plus</v-icon>
                                            </template>
                                            <v-list-item-title class="text-body-2">åˆ›å»ºå’Œåˆ†é…ä»»åŠ¡</v-list-item-title>
                                        </v-list-item>
                                        <v-list-item>
                                            <template v-slot:prepend>
                                                <v-icon color="orange" size="small">mdi-chart-timeline</v-icon>
                                            </template>
                                            <v-list-item-title class="text-body-2">ä»»åŠ¡è¿›åº¦è·Ÿè¸ª</v-list-item-title>
                                        </v-list-item>
                                        <v-list-item>
                                            <template v-slot:prepend>
                                                <v-icon color="orange" size="small">mdi-account-check</v-icon>
                                            </template>
                                            <v-list-item-title class="text-body-2">ç”¨æˆ·æ´»åŠ¨ç›‘æ§</v-list-item-title>
                                        </v-list-item>
                                    </v-list>
                                </v-card-text>

                                <v-card-actions class="pa-6 pt-0">
                                    <v-btn color="orange" variant="elevated" block size="large" class="font-weight-bold"
                                        @click="goToTaskManagement">
                                        <v-icon start>mdi-clipboard-list</v-icon>
                                        è¿›å…¥ä»»åŠ¡ç®¡ç†
                                        <v-icon end>mdi-arrow-right</v-icon>
                                    </v-btn>
                                </v-card-actions>
                            </v-card>
                        </v-col>
                    </v-row>
                </div>
            </v-container>

        </div>
        <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
        <div class="stats-overview mb-8">
            <v-row>
                <v-col cols="12" sm="6" md="3">
                    <v-card class="stat-card" elevation="4" rounded="xl" color="primary">
                        <v-card-text class="pa-6 text-center text-white">
                            <v-icon size="48" class="mb-3">mdi-fruit-cherries</v-icon>
                            <div class="text-h4 font-weight-bold">{{ adminStats.fruitCount }}</div>
                            <div class="text-subtitle-1">æ°´æœç§ç±»</div>
                        </v-card-text>
                    </v-card>
                </v-col>
                <v-col cols="12" sm="6" md="3">
                    <v-card class="stat-card" elevation="4" rounded="xl" color="success">
                        <v-card-text class="pa-6 text-center text-white">
                            <v-icon size="48" class="mb-3">mdi-account-group</v-icon>
                            <div class="text-h4 font-weight-bold">{{ adminStats.userCount }}</div>
                            <div class="text-subtitle-1">æ³¨å†Œç”¨æˆ·</div>
                        </v-card-text>
                    </v-card>
                </v-col>
                <v-col cols="12" sm="6" md="3">
                    <v-card class="stat-card" elevation="4" rounded="xl" color="warning">
                        <v-card-text class="pa-6 text-center text-white">
                            <v-icon size="48" class="mb-3">mdi-clipboard-list</v-icon>
                            <div class="text-h4 font-weight-bold">{{ taskStats.totalTasks }}</div>
                            <div class="text-subtitle-1">ä»»åŠ¡æ€»æ•°</div>
                        </v-card-text>
                    </v-card>
                </v-col>
                <v-col cols="12" sm="6" md="3">
                    <v-card class="stat-card" elevation="4" rounded="xl" color="info">
                        <v-card-text class="pa-6 text-center text-white">
                            <v-icon size="48" class="mb-3">mdi-chart-line</v-icon>
                            <div class="text-h4 font-weight-bold">{{ formatSales }}</div>
                            <div class="text-subtitle-1">ä»Šæ—¥é”€å”®é¢</div>
                        </v-card-text>
                    </v-card>
                </v-col>
            </v-row>
        </div>
    </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { useAuthStore } from '@/stores/auth'
import { getAdminStats, type AdminStats } from '@/utils/admin-api'
import AppNavigation from '@/components/AppNavigation.vue'

const router = useRouter()
const authStore = useAuthStore()

// å“åº”å¼æ•°æ®
const loading = ref(false)
const adminStats = ref<AdminStats>({
    fruitCount: 0,
    userCount: 0,
    pendingOrders: 0,
    todaySales: 0
})

// ä»»åŠ¡ç»Ÿè®¡æ•°æ®ï¼ˆæ¨¡æ‹Ÿï¼‰
const taskStats = ref({
    totalTasks: 45,
    activeTasks: 23,
    completedTasks: 22
})

// å¿«é€Ÿæ“ä½œåˆ—è¡¨
const quickActions = ref([
    { title: 'æ·»åŠ æ°´æœ', icon: 'mdi-plus', color: 'primary', action: 'add-fruit' },
    { title: 'ç”¨æˆ·ç®¡ç†', icon: 'mdi-account-group', color: 'success', action: 'user-management' },
    { title: 'ç³»ç»Ÿè®¾ç½®', icon: 'mdi-cog', color: 'info', action: 'system-settings' },
    { title: 'æ•°æ®æŠ¥è¡¨', icon: 'mdi-chart-bar', color: 'purple', action: 'reports' },
    { title: 'å¤‡ä»½æ•°æ®', icon: 'mdi-database-export', color: 'orange', action: 'backup' },
    { title: 'ç³»ç»Ÿæ—¥å¿—', icon: 'mdi-text-box-search', color: 'grey', action: 'logs' }
])

// è®¡ç®—å±æ€§
const formatSales = computed(() => {
    const sales = adminStats.value.todaySales
    if (sales >= 10000) {
        return `Â¥${(sales / 1000).toFixed(1)}k`
    }
    return `Â¥${sales}`
})

// æ–¹æ³•
const goToFruitManagement = () => {
    console.log('Navigating to Fruit Management page')
    // ç¡®ä¿è¿™é‡Œä½¿ç”¨çš„æ˜¯åœ¨ router/index.ts ä¸­å®šä¹‰çš„ name æˆ– path
    router.push({ name: 'FruitManagement' })
    // æˆ–è€…ä½¿ç”¨è·¯å¾„: router.push('/fruit-management')
}

const goToTaskManagement = () => {
    router.push('/task-management')
}

const goToUserManagement = () => {
    console.log('ğŸš€ è·³è½¬åˆ°ç”¨æˆ·ç®¡ç†')
    // router.push('/user-management') // ç­‰ç”¨æˆ·ç®¡ç†é¡µé¢å®Œæˆåå¯ç”¨
}

// åŠ è½½ç®¡ç†å‘˜ç»Ÿè®¡æ•°æ®
const loadAdminStats = async () => {
    try {
        const response = await getAdminStats()
        if (response.code === 200) {
            adminStats.value = response.data
        }
    } catch (error) {
        console.error('åŠ è½½ç®¡ç†å‘˜ç»Ÿè®¡æ•°æ®å¤±è´¥:', error)
        // ä½¿ç”¨é»˜è®¤æ•°æ®
        adminStats.value = {
            fruitCount: 23,
            userCount: 156,
            pendingOrders: 89,
            todaySales: 12500
        }
    }
}

onMounted(async () => {
    // æ£€æŸ¥ç®¡ç†å‘˜æƒé™
    if (!authStore.isAdmin) {
        router.replace('/user')
        return
    }

    await loadAdminStats()
})
</script>

<style scoped>
.admin-panel {
    min-height: 100vh;
    background: #f5f5f5;
}

.admin-content {
    margin-top: 64px;
}

.admin-icon {
    font-size: 4rem;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
}

.stat-card {
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
}

.module-card {
    transition: all 0.3s ease;
    cursor: pointer;
    border: 2px solid transparent;
}

.module-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15) !important;
    border-color: rgba(76, 175, 80, 0.3);
}

.module-icon {
    font-size: 3rem;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

.fruit-gradient {
    background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%);
}

.task-gradient {
    background: linear-gradient(135deg, #FF9800 0%, #FFB74D 100%);
}

.quick-action-card {
    transition: all 0.3s ease;
    cursor: pointer;
}

.quick-action-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
}

.section-title {
    font-size: 1.5rem;
    font-weight: 700;
    display: flex;
    align-items: center;
}

/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 600px) {
    .admin-content {
        margin-top: 56px;
    }

    .module-card .module-icon {
        font-size: 2.5rem;
    }
}
</style>
