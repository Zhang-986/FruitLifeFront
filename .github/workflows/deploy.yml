name: ğŸš€ éƒ¨ç½²åˆ° GitHub Pages

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

# è®¾ç½®æƒé™
permissions:
  contents: read
  pages: write
  id-token: write

# ç¡®ä¿åªæœ‰ä¸€ä¸ªéƒ¨ç½²ä»»åŠ¡åŒæ—¶è¿è¡Œ
concurrency:
  group: "pages"
  cancel-in-progress: false

# ç¯å¢ƒå˜é‡
env:
  NODE_VERSION: '18'

jobs:
  # æ„å»ºä»»åŠ¡
  build:
    name: ğŸ—ï¸ æ„å»ºé¡¹ç›®
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: ğŸ“¦ è®¾ç½® Node.js
      uses: actions/setup-node@v4
      with:
        node-version: ${{ env.NODE_VERSION }}
        cache: 'npm'

    - name: ğŸ” æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯
      run: |
        echo "ğŸ¯ é¡¹ç›®: æ°´æœç”Ÿæ´»å‰ç«¯"
        echo "ğŸŒŸ Node.js: ${{ env.NODE_VERSION }}"
        echo "ğŸ“¦ æ„å»ºç›®æ ‡: GitHub Pages"

    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: |
        echo "â³ å®‰è£…ä¾èµ–ä¸­..."
        npm ci
        echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"

    - name: ğŸ”§ ä»£ç æ£€æŸ¥ (å¯é€‰)
      run: |
        echo "ğŸ” æ‰§è¡Œä»£ç æ£€æŸ¥..."
        npm run lint || echo "âš ï¸ ä»£ç æ£€æŸ¥æœ‰è­¦å‘Šï¼Œç»§ç»­æ„å»º"

    - name: ğŸ—ï¸ æ„å»ºç”Ÿäº§ç‰ˆæœ¬
      run: |
        echo "ğŸ”¨ å¼€å§‹æ„å»º..."
        npm run build
        echo "âœ… æ„å»ºå®Œæˆ"
        
        # æ˜¾ç¤ºæ„å»ºç»“æœ
        echo "ğŸ“¦ æ„å»ºäº§ç‰©:"
        ls -la dist/
        echo "ğŸ“Š æ„å»ºå¤§å°:"
        du -sh dist/

    - name: ğŸ”§ é…ç½® Pages
      uses: actions/configure-pages@v4

    - name: ğŸ“¤ ä¸Šä¼ æ„å»ºäº§ç‰©
      uses: actions/upload-pages-artifact@v3
      with:
        path: ./dist

  # éƒ¨ç½²åˆ° GitHub Pages
  deploy:
    name: ğŸŒ éƒ¨ç½²åˆ° Pages
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    
    steps:
    - name: ğŸš€ éƒ¨ç½²åˆ° GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4

    - name: ğŸ‰ éƒ¨ç½²å®Œæˆ
      run: |
        echo "ğŸ‰ éƒ¨ç½²æˆåŠŸï¼"
        echo "ğŸŒ è®¿é—®åœ°å€: ${{ steps.deployment.outputs.page_url }}"
        echo "ğŸ“ è®¿é—®ä½ çš„æ°´æœç”Ÿæ´»åº”ç”¨å§ï¼"
